# –ß–µ–∫-–ª–∏—Å—Ç —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è Data Platform

–¶–µ–π –¥–æ–∫—É–º–µ–Ω—Ç –¥–æ–ø–æ–º–æ–∂–µ –≤–∞–º –∫—Ä–æ–∫ –∑–∞ –∫—Ä–æ–∫–æ–º —Ä–æ–∑–≥–æ—Ä–Ω—É—Ç–∏ –≤–µ—Å—å —Å—Ç–µ–∫ —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∏, –æ–ø–∏—Å–∞–Ω–∏–π —É —Ñ–∞–π–ª—ñ `DataPlatform.yml`.

## üü¢ –ö—Ä–æ–∫ 1: –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è AWS CLI
–ü–µ—Ä—à –∑–∞ –≤—Å–µ, –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ –ø–µ—Ä–µ–∫–æ–Ω–∞—Ç–∏—Å—è, —â–æ –≤–∏ –ø—Ä–∞—Ü—é—î—Ç–µ –∑ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–º –æ–±–ª—ñ–∫–æ–≤–∏–º –∑–∞–ø–∏—Å–æ–º.
1. –ü–µ—Ä–µ–≥–ª—è–Ω—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ –ø—Ä–æ—Ñ—ñ–ª—ñ: 
   ```bash
   aws configure list-profiles
   ```
2. –û–±–µ—Ä—ñ—Ç—å –ø–æ—Ç—Ä—ñ–±–Ω–∏–π –ø—Ä–æ—Ñ—ñ–ª—å –¥–ª—è –ø–æ—Ç–æ—á–Ω–æ—ó —Å–µ—Å—ñ—ó:
   ```bash
   export AWS_PROFILE=data_engineer_vlad
   export AWS_DEFAULT_REGION=eu-north-1
   ```
3. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —á–∏ –≤–∏ –∑–∞–ª–æ–≥—ñ–Ω–µ–Ω—ñ:
   ```bash
   aws sts get-caller-identity --region eu-north-1
   ```

## üü¢ –ö—Ä–æ–∫ 2: –ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤
–í–∞–º –∑–Ω–∞–¥–æ–±–ª—è—Ç—å—Å—è –Ω–∞–¥—ñ–π–Ω—ñ –ø–∞—Ä–æ–ª—ñ –¥–ª—è Redshift —Ç–∞ Airflow (–º—ñ–Ω—ñ–º—É–º 8 —Å–∏–º–≤–æ–ª—ñ–≤).
*   **RedshiftMasterPassword:** –ø–∞—Ä–æ–ª—å –¥–ª—è –∞–¥–º—ñ–Ω–∞ DWH.
*   **AirflowAdminPassword:** –ø–∞—Ä–æ–ª—å –¥–ª—è –≤—Ö–æ–¥—É –≤ UI Airflow.
*   **AirflowS3BucketName:** –Ω–∞–∑–≤–∞ –±–∞–∫–µ—Ç–∞ (–º–∞—î –±—É—Ç–∏ —É–Ω—ñ–∫–∞–ª—å–Ω–æ—é –≤ —É—Å—å–æ–º—É AWS).

## üü¢ –ö—Ä–æ–∫ 3: –í–∞–ª—ñ–¥–∞—Ü—ñ—è —à–∞–±–ª–æ–Ω—É
–ó–∞–≤–∂–¥–∏ –∫–æ—Ä–∏—Å–Ω–æ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ YAML —Ñ–∞–π–ª –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º:
```bash
aws cloudformation validate-template --template-body file://DataPlatform.yml --region eu-north-1
```

## üü¢ –ö—Ä–æ–∫ 4: –†–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è (Deployment)
–ó–∞–ø—É—Å—Ç—ñ—Ç—å —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Å—Ç–µ–∫—É. –í–µ—Å—å –ø—Ä–æ—Ü–µ—Å –º–æ–∂–µ –∑–∞–π–Ω—è—Ç–∏ 15-20 —Ö–≤–∏–ª–∏–Ω (–Ω–∞–π–¥–æ–≤—à–µ —Å—Ç–≤–æ—Ä—é—é—Ç—å—Å—è Redshift Serverless —Ç–∞ RDS).

```bash
export $(grep -v '^#' .env | xargs)
```

```bash
aws cloudformation deploy \
  --template-file DataPlatform.yml \
  --stack-name data-platform-production \
  --region eu-north-1 \
  --parameter-overrides \
    ProjectName=data-platform \
    RedshiftMasterPassword=$RedshiftMasterPassword \
    AirflowAdminPassword=$AirflowAdminPassword \
    AirflowS3BucketName=$AirflowS3BucketName \
  --capabilities CAPABILITY_NAMED_IAM
```
*–í–∞–∂–ª–∏–≤–æ: –§–ª–∞–≥ `--capabilities CAPABILITY_NAMED_IAM` –æ–±–æ–≤'—è–∑–∫–æ–≤–∏–π, –æ—Å–∫—ñ–ª—å–∫–∏ —à–∞–±–ª–æ–Ω —Å—Ç–≤–æ—Ä—é—î –∫–∞—Å—Ç–æ–º–Ω—ñ IAM —Ä–æ–ª—ñ.*

## üü¢ –ö—Ä–æ–∫ 5: –û—Ç—Ä–∏–º–∞–Ω–Ω—è —Ç–æ—á–æ–∫ –¥–æ—Å—Ç—É–ø—É
–ü—ñ—Å–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –¥–µ–ø–ª–æ—é (—Å—Ç–∞—Ç—É—Å `CREATE_COMPLETE`), –æ—Ç—Ä–∏–º–∞–π—Ç–µ URL –¥–ª—è –¥–æ—Å—Ç—É–ø—É:
```bash
aws cloudformation describe-stacks \
  --stack-name data-platform-production \
  --region eu-north-1 \
  --query "Stacks[0].Outputs"
```
–ó–Ω–∞–π–¥—ñ—Ç—å —É —Å–ø–∏—Å–∫—É `AirflowWebUI`. –í—ñ–¥–∫—Ä–∏–π—Ç–µ —Ü–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è —É –±—Ä–∞—É–∑–µ—Ä—ñ.

## üü¢ –ö—Ä–æ–∫ 6: –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è DAG-—Ñ–∞–π–ª—ñ–≤
–í–∞—à Airflow –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∏–π –Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω—É —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—é –∑ S3 –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω.
1. –ü–µ—Ä–µ–π–¥—ñ—Ç—å –¥–æ —Å—Ç–≤–æ—Ä–µ–Ω–æ–≥–æ S3 –±–∞–∫–µ—Ç–∞ –¥–ª—è Airflow.
2. –°—Ç–≤–æ—Ä—ñ—Ç—å —Ç–∞–º –ø–∞–ø–∫—É `dags/`.
3. –ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ —Ç—É–¥–∏ –≤–∞—à –ø–µ—Ä—à–∏–π DAG (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `test_dag.py`).
4. –ü–æ—á–µ–∫–∞–π—Ç–µ 5 —Ö–≤–∏–ª–∏–Ω, –ø–æ–∫–∏ ECS Task `dag-sync` –ø–µ—Ä–µ–Ω–µ—Å–µ —Ñ–∞–π–ª–∏ –Ω–∞ EFS.

## üü¢ –ö—Ä–æ–∫ 7: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑'—î–¥–Ω–∞–Ω—å
1. **Redshift:** –°–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–π—Ç–∏ –≤ –∫–æ–Ω—Å–æ–ª—å Redshift Query Editor v2.
2. **Athena:** –í–∏–∫–æ–Ω–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤–∏–π –∑–∞–ø–∏—Ç `SELECT * FROM ...` —á–µ—Ä–µ–∑ –∫–æ–Ω—Å–æ–ª—å Athena, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ —Å—Ç–≤–æ—Ä–µ–Ω—É Glue Database.

---
‚ö†Ô∏è **–£–≤–∞–≥–∞ —â–æ–¥–æ –µ–∫–æ–Ω–æ–º—ñ—ó:** –Ø–∫ —Ç—ñ–ª—å–∫–∏ –≤–∏ –∑–∞–≤–µ—Ä—à–∏—Ç–µ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è, –Ω–µ –∑–∞–±—É–¥—å—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —Å—Ç–µ–∫, —â–æ–± –∑—É–ø–∏–Ω–∏—Ç–∏ –Ω–∞—Ä–∞—Ö—É–≤–∞–Ω–Ω—è –∫–æ—à—Ç—ñ–≤ (–æ—Å–æ–±–ª–∏–≤–æ –∑–∞ NAT Gateway —Ç–∞ RDS):
```bash
aws cloudformation delete-stack --stack-name data-platform-production --region eu-north-1
```
